import{h as k,r as l,D as p,E as P,o as E,G as A,H as g,v as V,I as d,x as B,n,B as C,p as J,z as L,t as y,J as j,j as x,K as _,L as z,_ as N}from"./index-DmSqAegA.js";import"//at.alicdn.com/t/c/font_4565805_mtkshfnyzag.js";const T={class:"login-container"},U={class:"icon-container"},Y=["src"],$={class:"login-title"},w=k({__name:"LogIn",setup(D){const h=V(),i=l(!1),t=l(""),c=l(!1),v=l(!1),I=p(()=>v.value?"登录SessionKey":"登录秘钥"),f=p(()=>{if(t.value.length<=4)return t.value;{const a=t.value.length;return t.value.slice(0,4)+"****"+t.value.slice(a-8,a)}}),b=p(()=>v.value?"输入SessionKey(sk-ant-xxxx)":"输入登录秘钥(sj-xxxxxx)");function K(){const a=Number(x("client_idx")),e=x("client_type")??"plus",s=t.value,r=`${z}/api/v1/api_key/validate_key/${s}`;s!=""&&(i.value=!0,fetch(r,{method:"GET",headers:{accept:"application/json"}}).then(o=>o.json()).then(o=>{o.is_valid?(_.success("登录成功"),localStorage.setItem("SJ_API_KEY",s),h.push({path:"/",query:{api_key:s,client_idx:a,client_type:e}})):(_.error("该密码已过期或不存在，请重新购买。"),localStorage.removeItem("SJ_API_KEY"))}).catch(o=>{console.log(`登录发生错误${o}`),_.error("登录发生错误"),localStorage.removeItem("SJ_API_KEY")}).finally(()=>{i.value=!1}))}function m(){K()}const S=l(!1);return P(async()=>{const a=localStorage.getItem("SJ_API_KEY");a&&(t.value=a)}),E(()=>{c.value=!S.value}),(a,e)=>{const s=d("a-input"),r=d("a-button"),o=d("a-modal");return B(),A(o,{open:c.value,"onUpdate:open":e[1]||(e[1]=u=>c.value=u),footer:null,centered:"",closable:!1,keyboard:!1,maskClosable:!1,width:"400px"},{default:g(()=>[n("div",T,[n("div",U,[n("img",{class:"app-icon",src:C(J),alt:"AI Login"},null,8,Y)]),n("h2",$,L(I.value),1),y(s,{value:f.value,"onUpdate:value":e[0]||(e[0]=u=>f.value=u),size:"large",placeholder:b.value,onPressEnter:m,autocomplete:"off",class:"login-input"},null,8,["value","placeholder"]),y(r,{disabled:i.value,onClick:m,type:"primary",size:"large",class:"login-button"},{default:g(()=>e[2]||(e[2]=[j(" 登录 ")])),_:1},8,["disabled"]),e[3]||(e[3]=n("p",{class:"login-hint"},"请输入有效的登录密钥以继续",-1))])]),_:1},8,["open"])}}}),q=N(w,[["__scopeId","data-v-1bf823be"]]);export{q as default};
