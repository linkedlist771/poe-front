import{a7 as G,a8 as J,a9 as te,aa as d,ab as F,ac as ae,ad as se,ae as oe,af as O,ag as ne,L as Y,h as K,r as f,D as R,o as q,x as v,G as B,H as g,n as m,m as E,B as z,ah as re,z as P,F as Q,N as W,t as _,J as b,ai as le,aj as ce,ak as ie,al as ue,K as h,_ as Z,v as de,w as ve,O as ge,I as T,y as U,q as pe,am as he}from"./index-D1sJfEYs.js";import"//at.alicdn.com/t/c/font_4565805_mtkshfnyzag.js";const S=(o,e)=>new G(o).setAlpha(e).toRgbString(),M=(o,e)=>new G(o).lighten(e).toHexString(),fe=o=>{const e=J(o,{theme:"dark"});return{1:e[0],2:e[1],3:e[2],4:e[3],5:e[6],6:e[5],7:e[4],8:e[6],9:e[5],10:e[4]}},_e=(o,e)=>{const a=o||"#000",t=e||"#fff";return{colorBgBase:a,colorTextBase:t,colorText:S(t,.85),colorTextSecondary:S(t,.65),colorTextTertiary:S(t,.45),colorTextQuaternary:S(t,.25),colorFill:S(t,.18),colorFillSecondary:S(t,.12),colorFillTertiary:S(t,.08),colorFillQuaternary:S(t,.04),colorBgElevated:M(a,12),colorBgContainer:M(a,8),colorBgLayout:M(a,0),colorBgSpotlight:M(a,26),colorBorder:M(a,26),colorBorderSecondary:M(a,19)}},me=(o,e)=>{const a=Object.keys(te).map(n=>{const c=J(o[n],{theme:"dark"});return new Array(10).fill(1).reduce((y,x,r)=>(y[`${n}-${r+1}`]=c[r],y),{})}).reduce((n,c)=>(n=d(d({},n),c),n),{}),t=e??F(o);return d(d(d({},t),a),ae(o,{generateColorPalettes:fe,generateNeutralColorPalettes:_e}))};function ye(o){const{sizeUnit:e,sizeStep:a}=o,t=a-2;return{sizeXXL:e*(t+10),sizeXL:e*(t+6),sizeLG:e*(t+2),sizeMD:e*(t+2),sizeMS:e*(t+1),size:e*t,sizeSM:e*t,sizeXS:e*(t-1),sizeXXS:e*(t-1)}}const ke=(o,e)=>{const a=e??F(o),t=a.fontSizeSM,n=a.controlHeight-4;return d(d(d(d(d({},a),ye(e??o)),se(t)),{controlHeight:n}),oe(d(d({},a),{controlHeight:n})))};function Se(){const[o,e,a]=ne();return{theme:o,token:e,hashId:a}}const Te={defaultConfig:O,defaultSeed:O.token,useToken:Se,defaultAlgorithm:F,darkAlgorithm:me,compactAlgorithm:ke},xe=Y,Ce=xe+"/api/v1";async function we(o,e,a,t=null,n=null){o=Ce+o,t&&(o+="?"+new URLSearchParams(t).toString());try{return(await fetch(o,{method:e,headers:a,body:n?JSON.stringify(n):void 0})).json()}catch(c){console.error("Error:",c)}}async function ee(o,e,a=null,t=null){return we(o,e,{"Content-Type":"application/json"},a,t)}const Ie={class:"header-content"},$e={class:"value-display"},De={key:1,class:"stored-value"},Me={class:"button-container"},N="SJ_API_KEY",ze=K({__name:"HeaderComponent",setup(o){const e=f(""),a=f(""),t=f(!1),n=f(!1),c=R(()=>{const s=e.value;return s.length<=4?s:s.length<=8?s.slice(0,4)+"*".repeat(s.length-4):s.slice(0,4)+"****..."}),y=R(()=>e.value?"重置秘钥":"输入秘钥"),x=()=>{const s=localStorage.getItem(N);s?(e.value=s,$()):r()},r=()=>{t.value=!0},i=()=>{t.value=!1,a.value=""},C=async()=>{const s=localStorage.getItem("SJ_API_KEY"),p=`${Y}/api/v1/device_verification/device/${s}/update`;try{const l=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`Network response was not ok: ${l.statusText}`);const k=await l.json();console.log(k)}catch(l){console.error("Device status check failed:",l)}},w=()=>{if(a.value.trim()){localStorage.setItem(N,a.value),e.value=a.value,a.value="",t.value=!1,h.success("秘钥保存成功");try{$()}catch{}try{C()}catch{}}else h.error("请输入秘钥")},I=()=>{localStorage.removeItem(N),e.value="",h.success("秘钥重置成功")},u=()=>{e.value?I():r()},V=s=>{const p=new Date,l=new Date(s);if(isNaN(l.getTime()))return"无效的过期时间";const k=l.getTime()-p.getTime();if(k<0)return"已经过期";const L=Math.floor(k/(1e3*60*60*24)),A=Math.floor(k%(1e3*60*60*24)/(1e3*60*60)),H=Math.floor(k%(1e3*60*60)/(1e3*60));let D="";return L>0&&(D+=`${L}天`),(A>0||L>0)&&(D+=`${A}小时`),D+=`${H}分钟`,D},$=async()=>{n.value=!0;try{const s=await ee("/api_key/get_information/"+e.value,"GET");if(s.is_key_valid){const l=String(s.expire_time),k=s.usage_limit,L=s.current_usage,A=k-L;if(l=="Never expire")h.success("秘钥未激活， 等待激活后显示过期时间。");else{const H=V(l),D=new Date(l.replace(" ","T")),j=Math.ceil((D.getTime()-new Date().getTime())/(1e3*60*60*24));j<=7&&h.warning(`秘钥即将过期，剩余${j}天`),h.success(`剩余有效期：${H}`)}h.info(`剩余使用积分：${A}`)}else h.error("秘钥无效， 请输入有效的秘钥"),localStorage.removeItem(N),e.value="",a.value=""}catch(s){console.error(s),h.error("获取信息失败")}finally{n.value=!1}};return q(()=>{x()}),(s,p)=>(v(),B(z(ue),{class:"header"},{default:g(()=>[m("div",Ie,[m("div",$e,[e.value?(v(),E(Q,{key:0},[n.value?(v(),B(z(re),{key:0})):(v(),E("span",De,"存储秘钥: "+P(c.value),1))],64)):W("",!0),m("div",Me,[_(z(le),{class:"custom-button",size:"small",onClick:u},{default:g(()=>[b(P(y.value),1)]),_:1})])])]),_(z(ie),{visible:t.value,"onUpdate:visible":p[1]||(p[1]=l=>t.value=l),title:"输入新秘钥",onOk:w,onCancel:i},{default:g(()=>[_(z(ce),{value:a.value,"onUpdate:value":p[0]||(p[0]=l=>a.value=l),placeholder:"请输入秘钥"},null,8,["value"])]),_:1},8,["visible"])]),_:1}))}}),be=Z(ze,[["__scopeId","data-v-f3d24c11"]]),Be={class:"content-wrapper"},Ve={class:"header"},Le={class:"theme-toggle-container"},Ee=["innerHTML"],Ae={key:1,class:"account-list"},Ne=K({__name:"Index",setup(o){const e=de();ve();const a=f(!0),t=f(!1),n=f(`
  <p>
    1、POE账号是积分制，不存在速率限制，在该账号积分使用完毕之前均可使用，<span class="highlight">请注意您的积分消耗速度</span>，即使在有效期内，<strong>积分消耗完后也将无法使用，需要重新续费增加积分</strong>。<br><br>
    2、<span class="highlight">请注意您的秘钥有效期</span>，<strong>秘钥过期后将无法使用</strong>，续费会重置积分，不会累积。
  </p>
`),c=f([]),y=f(!1);ge(t,r=>{console.log("Theme changed:",r?"Dark":"Light")});const x=r=>{const i=r.idx,C=r.type;e.push({path:"/login",query:{client_idx:String(i),client_type:C}})};return R(()=>r=>r.is_session_login?"#87d068":r.type==="normal"?"#2db7f5":r.usage<10&&r.status!=="cd"?"#ffff00":"#f50"),q(async()=>{const r=async()=>{try{const u=await ee("/clients_status","GET");return u&&u.length>0?(c.value=u.sort((V,$)=>$.usage-V.usage),y.value=u.length>=10,a.value=!1,!0):!1}catch(u){return console.error("Error loading data:",u),!1}};let w=0;const I=async()=>{await r()||(w++,w<10?setTimeout(I,2e3):(a.value=!1,h.error("加载数据失败，请刷新页面重试")))};I()}),(r,i)=>{const C=T("a-switch"),w=T("a-spin"),I=T("a-tag"),u=T("a-statistic"),V=T("a-card"),$=T("a-divider");return v(),E("div",{class:U(["account-pool",{"dark-theme":t.value}])},[m("div",Be,[m("div",Ve,[m("div",Le,[_(C,{checked:t.value,"onUpdate:checked":i[0]||(i[0]=s=>t.value=s)},{checkedChildren:g(()=>i[1]||(i[1]=[b("🌙")])),unCheckedChildren:g(()=>i[2]||(i[2]=[b("☀️")])),_:1},8,["checked"])]),m("div",{class:U(["notice",{dark:t.value}])},[m("div",{innerHTML:n.value},null,8,Ee)],2)]),a.value?(v(),B(w,{key:0})):(v(),E("div",Ae,[(v(!0),E(Q,null,pe(c.value,s=>(v(),B(V,{key:s.id,hoverable:"",bordered:!1,class:U(["account-card",{dark:t.value,"card-plus":s.type==="plus","card-normal":s.type==="normal","card-cd":s.status==="cd"}]),onClick:p=>x(s)},{extra:g(()=>[_(I,{color:s.type==="normal"?"#2db7f5":"#f50"},{default:g(()=>[b(P(s.type),1)]),_:2},1032,["color"])]),default:g(()=>[b(" "+P(s.id)+" ",1),_(u,{title:"该账号剩余可用积分",value:s.usage,"value-style":{color:"#3f8600"}},null,8,["value"]),_(u,{title:"状态",value:s.status==="cd"?"冷却":"可用","value-style":{color:s.status==="cd"?"#cf1322":"#3f8600"}},null,8,["value","value-style"])]),_:2},1032,["class","onClick"]))),128))])),y.value?(v(),B($,{key:2,dashed:"",style:{"font-size":"14px","margin-top":"20px"}},{default:g(()=>i[3]||(i[3]=[b(" 上拉加载更多 ")])),_:1})):W("",!0)])],2)}}}),Pe=Z(Ne,[["__scopeId","data-v-4c219dea"]]),He={style:{"margin-top":"40px"}},X="isDarkTheme",Fe=K({__name:"ClientsStatus",setup(o){const e=localStorage.getItem(X),a=f(e==="true"),t={algorithm:Te.darkAlgorithm},n=c=>{a.value=c,localStorage.setItem(X,String(c))};return(c,y)=>{const x=T("a-message-provider");return v(),B(z(he),{theme:a.value?t:void 0},{default:g(()=>[_(x,null,{default:g(()=>[_(be)]),_:1}),m("div",He,[_(Pe,{isDarkTheme:a.value,onChangeIsDarkTheme:n},null,8,["isDarkTheme"])])]),_:1},8,["theme"])}}});export{Fe as default};
