import{a6 as J,a7 as Y,a8 as te,a9 as v,aa as F,ab as ae,ac as se,ad as oe,ae as O,af as ne,S as q,h as K,r as g,O as H,o as G,v as p,Q as B,J as f,m,l as E,y as b,ag as re,x as N,F as Q,I as W,p as h,R as z,ah as le,ai as ce,aj as ie,ak as ue,K as _,B as Z,q as de,t as ve,N as x,w as R,n as pe,al as fe}from"./index-GOOJzmf8.js";import"//at.alicdn.com/t/c/font_4565805_mtkshfnyzag.js";const S=(s,e)=>new J(s).setAlpha(e).toRgbString(),D=(s,e)=>new J(s).lighten(e).toHexString(),ge=s=>{const e=Y(s,{theme:"dark"});return{1:e[0],2:e[1],3:e[2],4:e[3],5:e[6],6:e[5],7:e[4],8:e[6],9:e[5],10:e[4]}},he=(s,e)=>{const a=s||"#000",t=e||"#fff";return{colorBgBase:a,colorTextBase:t,colorText:S(t,.85),colorTextSecondary:S(t,.65),colorTextTertiary:S(t,.45),colorTextQuaternary:S(t,.25),colorFill:S(t,.18),colorFillSecondary:S(t,.12),colorFillTertiary:S(t,.08),colorFillQuaternary:S(t,.04),colorBgElevated:D(a,12),colorBgContainer:D(a,8),colorBgLayout:D(a,0),colorBgSpotlight:D(a,26),colorBorder:D(a,26),colorBorderSecondary:D(a,19)}},_e=(s,e)=>{const a=Object.keys(te).map(r=>{const c=Y(s[r],{theme:"dark"});return new Array(10).fill(1).reduce((y,C,T)=>(y[`${r}-${T+1}`]=c[T],y),{})}).reduce((r,c)=>(r=v(v({},r),c),r),{}),t=e??F(s);return v(v(v({},t),a),ae(s,{generateColorPalettes:ge,generateNeutralColorPalettes:he}))};function me(s){const{sizeUnit:e,sizeStep:a}=s,t=a-2;return{sizeXXL:e*(t+10),sizeXL:e*(t+6),sizeLG:e*(t+2),sizeMD:e*(t+2),sizeMS:e*(t+1),size:e*t,sizeSM:e*t,sizeXS:e*(t-1),sizeXXS:e*(t-1)}}const ye=(s,e)=>{const a=e??F(s),t=a.fontSizeSM,r=a.controlHeight-4;return v(v(v(v(v({},a),me(e??s)),se(t)),{controlHeight:r}),oe(v(v({},a),{controlHeight:r})))};function ke(){const[s,e,a]=ne();return{theme:s,token:e,hashId:a}}const Se={defaultConfig:O,defaultSeed:O.token,useToken:ke,defaultAlgorithm:F,darkAlgorithm:_e,compactAlgorithm:ye},Te=q,xe=Te+"/api/v1";async function Ce(s,e,a,t=null,r=null){s=xe+s,t&&(s+="?"+new URLSearchParams(t).toString());try{return(await fetch(s,{method:e,headers:a,body:r?JSON.stringify(r):void 0})).json()}catch(c){console.error("Error:",c)}}async function ee(s,e,a=null,t=null){return Ce(s,e,{"Content-Type":"application/json"},a,t)}const we={class:"header-content"},$e={class:"value-display"},Ie={key:1,class:"stored-value"},Me={class:"button-container"},U="SJ_API_KEY",De=K({__name:"HeaderComponent",setup(s){const e=g(""),a=g(""),t=g(!1),r=g(!1),c=H(()=>{const o=e.value;return o.length<=4?o:o.length<=8?o.slice(0,4)+"*".repeat(o.length-4):o.slice(0,4)+"****..."}),y=H(()=>e.value?"重置秘钥":"输入秘钥"),C=()=>{const o=localStorage.getItem(U);o?(e.value=o,L()):T()},T=()=>{t.value=!0},u=()=>{t.value=!1,a.value=""},i=async()=>{const o=localStorage.getItem("SJ_API_KEY"),n=`${q}/api/v1/device_verification/device/${o}/update`;try{const l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`Network response was not ok: ${l.statusText}`);const k=await l.json();console.log(k)}catch(l){console.error("Device status check failed:",l)}},w=()=>{a.value.trim()?(localStorage.setItem(U,a.value),e.value=a.value,a.value="",t.value=!1,_.success("秘钥保存成功"),L(),i()):_.error("请输入秘钥")},$=()=>{localStorage.removeItem(U),e.value="",_.success("秘钥重置成功")},I=()=>{e.value?$():T()},d=o=>{const n=new Date,l=new Date(o);if(isNaN(l.getTime()))return"无效的过期时间";const k=l.getTime()-n.getTime();if(k<0)return"已经过期";const V=Math.floor(k/(1e3*60*60*24)),A=Math.floor(k%(1e3*60*60*24)/(1e3*60*60)),P=Math.floor(k%(1e3*60*60)/(1e3*60));let M="";return V>0&&(M+=`${V}天`),(A>0||V>0)&&(M+=`${A}小时`),M+=`${P}分钟`,M},L=async()=>{r.value=!0;try{const o=await ee("/api_key/get_information/"+e.value,"GET");if(o.is_key_valid){const l=String(o.expire_time),k=o.usage_limit,V=o.current_usage,A=k-V;if(l=="Never expire")_.success("秘钥未激活， 等待激活后显示过期时间。");else{const P=d(l),M=new Date(l.replace(" ","T")),j=Math.ceil((M.getTime()-new Date().getTime())/(1e3*60*60*24));j<=7&&_.warning(`秘钥即将过期，剩余${j}天`),_.success(`剩余有效期：${P}`)}_.info(`剩余使用积分：${A}`)}}catch(o){console.error(o),_.error("获取信息失败")}finally{r.value=!1}};return G(()=>{C()}),(o,n)=>(p(),B(b(ue),{class:"header"},{default:f(()=>[m("div",we,[m("div",$e,[e.value?(p(),E(Q,{key:0},[r.value?(p(),B(b(re),{key:0})):(p(),E("span",Ie,"存储秘钥: "+N(c.value),1))],64)):W("",!0),m("div",Me,[h(b(le),{class:"custom-button",size:"small",onClick:I},{default:f(()=>[z(N(y.value),1)]),_:1})])])]),h(b(ie),{visible:t.value,"onUpdate:visible":n[1]||(n[1]=l=>t.value=l),title:"输入新秘钥",onOk:w,onCancel:u},{default:f(()=>[h(b(ce),{value:a.value,"onUpdate:value":n[0]||(n[0]=l=>a.value=l),placeholder:"请输入秘钥"},null,8,["value"])]),_:1},8,["visible"])]),_:1}))}}),be=Z(De,[["__scopeId","data-v-21a9d59a"]]),ze={class:"content-wrapper"},Be={class:"header"},Ve={class:"theme-toggle-container"},Ee=["innerHTML"],Le={key:1,class:"account-list"},Ae=K({__name:"Index",setup(s){const e=de();ve();const a=g(!0),t=g(!1),r=g(`
  <p>
    1、POE账号是积分制，不存在速率限制，在该账号积分使用完毕之前均可使用，<span class="highlight">请注意您的积分消耗速度</span>，即使在有效期内，<strong>积分消耗完后也将无法使用，需要重新续费增加积分</strong>。<br><br>
    2、<span class="highlight">请注意您的秘钥有效期</span>，<strong>秘钥过期后将无法使用</strong>，续费会重置积分，不会累积。
  </p>
`),c=g([]),y=g(!1),C=()=>{t.value=!t.value},T=u=>{const i=u.idx,w=u.type;e.push({path:"/login",query:{client_idx:String(i),client_type:w}})};return H(()=>u=>u.is_session_login?"#87d068":u.type==="normal"?"#2db7f5":u.usage<10&&u.status!=="cd"?"#ffff00":"#f50"),G(async()=>{const u=async()=>{try{const d=await ee("/clients_status","GET");return d&&d.length>0?(c.value=d,y.value=d.length>=10,a.value=!1,!0):!1}catch(d){return console.error("Error loading data:",d),!1}};let $=0;const I=async()=>{await u()||($++,$<10?setTimeout(I,2e3):(a.value=!1,_.error("加载数据失败，请刷新页面重试")))};I()}),(u,i)=>{const w=x("a-switch"),$=x("a-spin"),I=x("a-tag"),d=x("a-statistic"),L=x("a-card"),o=x("a-divider");return p(),E("div",{class:R(["account-pool",{"dark-theme":t.value}])},[m("div",ze,[m("div",Be,[m("div",Ve,[h(w,{checked:t.value,"onUpdate:checked":i[0]||(i[0]=n=>t.value=n),onChange:C},{checkedChildren:f(()=>i[1]||(i[1]=[z("🌙")])),unCheckedChildren:f(()=>i[2]||(i[2]=[z("☀️")])),_:1},8,["checked"])]),m("div",{class:R(["notice",{dark:t.value}])},[m("div",{innerHTML:r.value},null,8,Ee)],2)]),a.value?(p(),B($,{key:0})):(p(),E("div",Le,[(p(!0),E(Q,null,pe(c.value,n=>(p(),B(L,{key:n.id,hoverable:"",bordered:!1,class:R(["account-card",{dark:t.value,"card-plus":n.type==="plus","card-normal":n.type==="normal","card-cd":n.status==="cd"}]),onClick:l=>T(n)},{extra:f(()=>[h(I,{color:n.type==="normal"?"#2db7f5":"#f50"},{default:f(()=>[z(N(n.type),1)]),_:2},1032,["color"])]),default:f(()=>[z(" "+N(n.id)+" ",1),h(d,{title:"该账号剩余可用积分",value:n.usage,"value-style":{color:"#3f8600"}},null,8,["value"]),h(d,{title:"状态",value:n.status==="cd"?"冷却":"可用","value-style":{color:n.status==="cd"?"#cf1322":"#3f8600"}},null,8,["value","value-style"])]),_:2},1032,["class","onClick"]))),128))])),y.value?(p(),B(o,{key:2,dashed:"",style:{"font-size":"14px","margin-top":"20px"}},{default:f(()=>i[3]||(i[3]=[z(" 上拉加载更多 ")])),_:1})):W("",!0)])],2)}}}),Ne=Z(Ae,[["__scopeId","data-v-576be1f2"]]),Pe={style:{"margin-top":"40px"}},X="isDarkTheme",He=K({__name:"ClientsStatus",setup(s){const e=localStorage.getItem(X),a=g(e==="true"),t={algorithm:Se.darkAlgorithm},r=c=>{a.value=c,localStorage.setItem(X,String(c))};return(c,y)=>{const C=x("a-message-provider");return p(),B(b(fe),{theme:a.value?t:void 0},{default:f(()=>[h(C,null,{default:f(()=>[h(be)]),_:1}),m("div",Pe,[h(Ne,{isDarkTheme:a.value,onChangeIsDarkTheme:r},null,8,["isDarkTheme"])])]),_:1},8,["theme"])}}});export{He as default};
